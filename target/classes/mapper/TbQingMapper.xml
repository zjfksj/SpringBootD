<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zj.mapper.TbQingMapper" >
  <resultMap id="BaseResultMap" type="com.zj.entity.TbQing" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 11:16:27 CST 2019.
    -->
    <id column="Qing_no" property="qingNo" jdbcType="VARCHAR" />
    <result column="orders_no" property="ordersNo" jdbcType="VARCHAR" />
    <result column="Waybill_no" property="waybillNo" jdbcType="VARCHAR" />
    <result column="Pay_no" property="payNo" jdbcType="VARCHAR" />
    <result column="Stauts" property="stauts" jdbcType="VARCHAR" />
    <result column="Create_Time" property="createTime" jdbcType="TIMESTAMP" />
    <association property="st" javaType="com.zj.entity.Stauts">
		<id property="id" column="id" />
		<result column="name" property="name"/>
	</association>
    <association property="tbOrders" javaType="com.zj.entity.TbOrders">
        <id column="orders_no" property="ordersNo" jdbcType="INTEGER" />
        <result column="Cbename" property="cbename" jdbcType="VARCHAR" />
        <result column="cbecodeinsp" property="cbecodeinsp" jdbcType="VARCHAR" />
        <result column="Goods_number" property="goodsNumber" jdbcType="INTEGER" />
        <result column="User_name" property="userName" jdbcType="VARCHAR" />
        <result column="Total_Money" property="totalMoney" jdbcType="REAL" />
        <result column="Create_Time" property="createTime" jdbcType="TIMESTAMP" />
        <association property="tbOrdersdetails" javaType="com.zj.entity.TbOrdersdetails">
            <id column="ordersDetails_no" property="ordersdetailsNo" />
            <result column="orders_no" property="ordersNo"  />
            <result column="Goods_no" property="goodsNo" />
            <result column="Goods_name" property="goodsName" /> 
            <result column="Goodsinsp" property="goodsinsp" />
            <result column="Goods_price" property="goodsPrice"/>
            <result column="Goods_number" property="goodsNumber"/>
            <result column="Total" property="total" jdbcType="REAL" />
            <result column="Create_Time" property="createTime"/>
        </association>
    </association>
     <association property="tbPay" javaType="com.zj.entity.TbPay">
		<id column="Pay_no" property="payNo" jdbcType="VARCHAR" />
        <result column="orders_no" property="ordersNo" jdbcType="VARCHAR" />
        <result column="Zfcodeinsp" property="zfcodeinsp" jdbcType="VARCHAR" />
        <result column="Zfname" property="zfname" jdbcType="VARCHAR" />
        <result column="Pay_name" property="payName" jdbcType="VARCHAR" />
        <result column="Pay_Money" property="payMoney" jdbcType="REAL" />
        <result column="Pay_type" property="payType" jdbcType="VARCHAR" />
        <result column="Create_Time" property="createTime" jdbcType="TIMESTAMP" />
	</association>
    <association property="tbWaybill" javaType="com.zj.entity.TbWaybill">
		<id column="Waybill_no" property="waybillNo" jdbcType="VARCHAR" />
        <result column="Wlqycodeinsp" property="wlqycodeinsp" jdbcType="VARCHAR" />
        <result column="wlqyname" property="wlqyname" jdbcType="VARCHAR" />
        <result column="sender" property="sender" jdbcType="VARCHAR" />
        <result column="receiver" property="receiver" jdbcType="VARCHAR" />
        <result column="address" property="address" jdbcType="VARCHAR" />
        <result column="Create_Time" property="createTime" jdbcType="TIMESTAMP" />
	</association>
  </resultMap>
  
  <select id="findUserByPage1" resultMap="BaseResultMap">
   		select  a.*,c.*,d.*,e.*,s.*,GROUP_CONCAT(b.Goods_name SEPARATOR ',') Goods_name 
        from tb_orders a,tb_ordersdetails b ,tb_qing c,tb_pay d,tb_waybill e,stauts s
        where a.Orders_no=b.Orders_no  and c.orders_no=a.orders_no and c.Waybill_no=e.Waybill_no and c.Pay_no=d.orders_no and c.Stauts=s.id
        <if test='stauts == "1" '>
             and  c.Stauts='1'
        </if>
        <if test='stauts == "2" '>
            and c.Stauts='2'
        </if>
        <if test='stauts == "3" '>
            and c.Stauts='3' 
        </if>
        <if test='stauts == "4" '>
            and c.Stauts='4' 
        </if>
        <if test='stauts == "5" '>
            and c.Stauts='5' 
        </if>
        <if test='stauts == "7" '>
            and c.Stauts='7' 
        </if>
        <if test='stauts == "8" '>
            and c.Stauts='6' 
        </if>
        <if test="start != null and end != null and start!='' and end !=''">
                and c.Create_Time between #{start} and #{end}
        </if>
        <if test="username!=null"> 
           and c.Qing_no LIKE concat(concat('%',#{username}),'%') 
        </if>
        GROUP BY c.Qing_no
        limit #{0},#{1}
   </select>
   <!-- <select id="selectUsername" resultMap="BaseResultMap">
   		select *  from tb_qing where Qing_no=#{0} 
   </select> -->
     <select id="soucount1" resultType="int">
   		select count(c.Qing_no) 
        from tb_orders a,tb_ordersdetails b ,tb_qing c,tb_pay d,tb_waybill e,stauts s
        where a.Orders_no=b.Orders_no  and c.orders_no=a.orders_no and c.Waybill_no=e.Waybill_no and c.Pay_no=d.orders_no and c.Stauts=s.id
        <if test='stauts == "1" '>
             and  c.Stauts='1'
        </if>
        <if test='stauts == "2" '>
            and c.Stauts='2'
        </if>
        <if test='stauts == "3" '>
            and c.Stauts='3' 
        </if>
        <if test='stauts == "4" '>
            and c.Stauts='4' 
        </if>
        <if test='stauts == "5" '>
            and c.Stauts='5' 
        </if>
        <if test='stauts == "7" '>
            and c.Stauts='7' 
        </if>
        <if test='stauts == "8" '>
            and c.Stauts='6' 
        </if>
        <if test="start != null and end != null and start!='' and end !=''">
                and c.Create_Time between #{start} and #{end}
        </if>
        <if test="username!=null">
           and c.Qing_no LIKE concat(concat('%',#{username}),'%') 
        </if>
   </select>
   <delete id="delQing">
        delete from tb_qing where Qing_no=#{0}
   </delete>
   <select id="selectTbQing" resultMap="BaseResultMap">
        select * from tb_qing tq,stauts st where Qing_no=#{0} and tq.stauts=st.id
   </select>
   <update id="qingEdit">
        update tb_qing 
        <if test='stauts == "查验" '>
        	set stauts='3' where Qing_no=#{0}
        </if>
        <if test='stauts == "禁止出境" '>
        	set stauts='4' where Qing_no=#{0}
        </if>
        <if test='stauts == "放行" '>
        	set stauts='7' where Qing_no=#{0}
        </if>
        <if test='stauts == "同意1" '>
        	set stauts='5' where Qing_no=#{0}
        </if>
        <if test='stauts == "不同意1" '>
        	set stauts='3' where Qing_no=#{0}
        </if>
        <if test='stauts == "同意2" '>
        	set stauts='6' where Qing_no=#{0}
        </if>
        <if test='stauts == "不同意2" '>
        	set stauts='4' where Qing_no=#{0}
        </if>
   </update>
   <select id="selectStauts" resultType="Stauts">
        select * from stauts
   </select>
   <update id="plupdQing">
   		update tb_qing 
        <if test='stauts == "3" '>
        	set stauts='3' 
        </if>
        <if test='stauts == "4" '>
        	set stauts='4'
        </if>
        <if test='stauts == "7" '>
        	set stauts='7'
        </if>
        <if test='stauts == "5" '>
        	set stauts='5'
        </if>
        <if test='stauts == "6" '>
        	set stauts='6' 
        </if>
        where Qing_no in 
        <foreach collection="messageid" index="index" item="item"
			open="(" separator="," close=")">
			 #{item}
		</foreach>
   </update>
</mapper>